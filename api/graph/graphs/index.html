
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../branches/">
      
      
        <link rel="next" href="../hooks/">
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.3">
    
    
      
        <title>Graphs - edgygraph</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#src.edgygraph.graph.graphs" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="edgygraph" class="md-header__button md-logo" aria-label="edgygraph" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            edgygraph
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Graphs
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/mathisxy/edgygraph" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    mathisxy/edgygraph
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="edgygraph" class="md-nav__button md-logo" aria-label="edgygraph" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    edgygraph
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/mathisxy/edgygraph" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    mathisxy/edgygraph
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Edgy Graph
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Api
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Api
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" checked>
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Graph
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Graph
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../branches/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Branches
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Graphs
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Graphs
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#src.edgygraph.graph.graphs" class="md-nav__link">
    <span class="md-ellipsis">
      
        graphs
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.edgygraph.graph.graphs.Graph" class="md-nav__link">
    <span class="md-ellipsis">
      
        Graph
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Graph">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.edgygraph.graph.graphs.Graph--generic-typing-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Generic Typing Parameters
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Generic Typing Parameters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.edgygraph.graph.graphs.Graph--inheritance-with-variance" class="md-nav__link">
    <span class="md-ellipsis">
      
        Inheritance with Variance
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.edgygraph.graph.graphs.Graph--duck-typing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Duck Typing
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.edgygraph.graph.graphs.Graph--disable-type-checking" class="md-nav__link">
    <span class="md-ellipsis">
      
        Disable Type Checking
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.edgygraph.graph.graphs.Graph--edges" class="md-nav__link">
    <span class="md-ellipsis">
      
        Edges
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Edges">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.edgygraph.graph.graphs.Graph--branches" class="md-nav__link">
    <span class="md-ellipsis">
      
        Branches
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Branches">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.edgygraph.graph.graphs.Graph--spawning" class="md-nav__link">
    <span class="md-ellipsis">
      
        Spawning
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.edgygraph.graph.graphs.Graph--joining" class="md-nav__link">
    <span class="md-ellipsis">
      
        Joining
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.edgygraph.graph.graphs.Graph--formats" class="md-nav__link">
    <span class="md-ellipsis">
      
        Formats
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.edgygraph.graph.graphs.Graph.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __call__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.edgygraph.graph.graphs.Graph.run_branch" class="md-nav__link">
    <span class="md-ellipsis">
      
        run_branch
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.edgygraph.graph.graphs.Graph.node_wrapper" class="md-nav__link">
    <span class="md-ellipsis">
      
        node_wrapper
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.edgygraph.graph.graphs.Graph.merge_states" class="md-nav__link">
    <span class="md-ellipsis">
      
        merge_states
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.edgygraph.graph.graphs.Graph.apply_changes" class="md-nav__link">
    <span class="md-ellipsis">
      
        apply_changes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.edgygraph.graph.graphs.Graph.spawn_branches" class="md-nav__link">
    <span class="md-ellipsis">
      
        spawn_branches
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.edgygraph.graph.graphs.Graph.join_branches" class="md-nav__link">
    <span class="md-ellipsis">
      
        join_branches
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.edgygraph.graph.graphs.Graph.get_next" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_next
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.edgygraph.graph.graphs.Graph.get_next_from_error" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_next_from_error
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.edgygraph.graph.graphs.Graph.resolve_entry" class="md-nav__link">
    <span class="md-ellipsis">
      
        resolve_entry
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Hooks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../types/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Types
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nodes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Nodes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../states/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    States
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../diff/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Diff
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Graph Hooks
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Graph Hooks
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../graph_hooks/interactive_debug/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Interactive debug
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../graph_hooks/node_print/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Node print
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../rich/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Repr. Mixin
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#src.edgygraph.graph.graphs" class="md-nav__link">
    <span class="md-ellipsis">
      
        graphs
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.edgygraph.graph.graphs.Graph" class="md-nav__link">
    <span class="md-ellipsis">
      
        Graph
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Graph">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.edgygraph.graph.graphs.Graph--generic-typing-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Generic Typing Parameters
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Generic Typing Parameters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.edgygraph.graph.graphs.Graph--inheritance-with-variance" class="md-nav__link">
    <span class="md-ellipsis">
      
        Inheritance with Variance
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.edgygraph.graph.graphs.Graph--duck-typing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Duck Typing
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.edgygraph.graph.graphs.Graph--disable-type-checking" class="md-nav__link">
    <span class="md-ellipsis">
      
        Disable Type Checking
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.edgygraph.graph.graphs.Graph--edges" class="md-nav__link">
    <span class="md-ellipsis">
      
        Edges
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Edges">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.edgygraph.graph.graphs.Graph--branches" class="md-nav__link">
    <span class="md-ellipsis">
      
        Branches
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Branches">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.edgygraph.graph.graphs.Graph--spawning" class="md-nav__link">
    <span class="md-ellipsis">
      
        Spawning
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.edgygraph.graph.graphs.Graph--joining" class="md-nav__link">
    <span class="md-ellipsis">
      
        Joining
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.edgygraph.graph.graphs.Graph--formats" class="md-nav__link">
    <span class="md-ellipsis">
      
        Formats
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.edgygraph.graph.graphs.Graph.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __call__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.edgygraph.graph.graphs.Graph.run_branch" class="md-nav__link">
    <span class="md-ellipsis">
      
        run_branch
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.edgygraph.graph.graphs.Graph.node_wrapper" class="md-nav__link">
    <span class="md-ellipsis">
      
        node_wrapper
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.edgygraph.graph.graphs.Graph.merge_states" class="md-nav__link">
    <span class="md-ellipsis">
      
        merge_states
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.edgygraph.graph.graphs.Graph.apply_changes" class="md-nav__link">
    <span class="md-ellipsis">
      
        apply_changes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.edgygraph.graph.graphs.Graph.spawn_branches" class="md-nav__link">
    <span class="md-ellipsis">
      
        spawn_branches
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.edgygraph.graph.graphs.Graph.join_branches" class="md-nav__link">
    <span class="md-ellipsis">
      
        join_branches
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.edgygraph.graph.graphs.Graph.get_next" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_next
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.edgygraph.graph.graphs.Graph.get_next_from_error" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_next_from_error
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.edgygraph.graph.graphs.Graph.resolve_entry" class="md-nav__link">
    <span class="md-ellipsis">
      
        resolve_entry
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>Graphs</h1>

<div class="doc doc-object doc-module">



<a id="src.edgygraph.graph.graphs"></a>
    <div class="doc doc-contents first">










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="src.edgygraph.graph.graphs.Graph" class="doc doc-heading">
            <code>Graph</code>


</h2>


    <div class="doc doc-contents ">



        <p>Create and execute a graph defined by a list of edges</p>
<h4 id="src.edgygraph.graph.graphs.Graph--generic-typing-parameters">Generic Typing Parameters</h4>
<p>Use protocols or classes that extend <strong>StateProtocol</strong> and <strong>SharedProtocol</strong> or <strong>State</strong> and <strong>Shared</strong> to define the supported state types.</p>
<h5 id="src.edgygraph.graph.graphs.Graph--inheritance-with-variance">Inheritance with Variance</h5>
<p>With covariance its possible to use nodes that use more specific State and Shared classes as the generic typing parameters. Requires an inheritance structure.</p>
<p>This is recommended for smaller projects because it needs less boilerplate.</p>
<h5 id="src.edgygraph.graph.graphs.Graph--duck-typing">Duck Typing</h5>
<p>For the more flexible approach with better scaling use protocols to define the supported state types. Remember to always extend <code>typing.Protocol</code> in the child classes for typing.</p>
<p>This is recommended for scalable projects where many different state types need to be joined in one graph. See <a href="https://github.com/mathisxy/edgynodes/">edgynodes</a> for an example.</p>
<h5 id="src.edgygraph.graph.graphs.Graph--disable-type-checking">Disable Type Checking</h5>
<p>If you want to disable type checking for the graph, you can use <code>typing.Any</code> as generic typing parameters in the graph.</p>
<h4 id="src.edgygraph.graph.graphs.Graph--edges">Edges</h4>
<p>The edges are defined as a list of tuples, where the first element is the source and the second element reveals the next node.</p>
<h5 id="src.edgygraph.graph.graphs.Graph--branches">Branches</h5>
<p>The edges are contained in branches. A branch is a tuple with edges and a join parameter at the end. </p>
<h6 id="src.edgygraph.graph.graphs.Graph--spawning">Spawning</h6>
<p>A branch is spawned when the source of the first edge of the branch is triggered.</p>
<p>In this example it would be on <code>START</code>:</p>
<pre><code class="language-python">edges=[(
   (START, node1),
   (node1, node2),
   END
)]
</code></pre>
<p>In this example it would be on <code>node1</code> and on <code>node2</code> each:</p>
<pre><code class="language-python">edges=[(
   ([node1, node2], node3),
   node4
)]
</code></pre>
<h6 id="src.edgygraph.graph.graphs.Graph--joining">Joining</h6>
<p>The join parameter can be of the following types:</p>
<ul>
<li><code>None</code>: The branch will not be joined.</li>
<li><code>END</code>: The branch will be joined at the end of the graph.</li>
<li>A node instance: The branch will be joined directly before the given node is executed in any branch into this branch.</li>
</ul>
<p>The process of joining describes waiting for the branches to finish wich aim to join and then applying the changes to the state of the whole finished branch to the state of the joining branch.</p>
<h5 id="src.edgygraph.graph.graphs.Graph--formats">Formats</h5>
<p>A branch supports different formats for the edges.</p>
<ul>
<li><code>(source, target)</code>: A single edge from source to target.</li>
<li><code>(START, target)</code>: A single edge from the start of the graph to target.</li>
<li><code>(source, None)</code>: A single edge from source to no target. <code>END</code> is not allowed here, since it would be redundant. It is only allowed in join parameters to distinct join at the end of the graph (<code>END</code>) from not joining (<code>None</code>)</li>
<li><code>([source1, source2], target)</code>: Multiple edges from source1 and source2 to target.</li>
<li><code>(source, [target1, target2])</code>: Multiple edges from source to target1 and target2.</li>
<li><code>([source1, source2], [target1, target2])</code>: Multiple edges from source1 and source2 to target1 and target2. This will create 4 edges in total.</li>
<li><code>(source, lambda st, sh: [target1, target2] if sh.x)</code>: A dynamic edge from source to target. The function takes the state and the shared state as arguments. It must return a node, a list of nodes, END or None. Async functions are also supported. They are executed sequentially so there are no race conditions.</li>
<li><code>(source, target, Config(instant=True))</code>: An instant edge from source to target. The target nodes are collected recursively and executed parallel to the source node. Make sure not to create cycles.</li>
<li><code>(ValueError, target)</code>: An error edge from ValueError to target. The edge is traversed if a node, which is executed by an incoming edge located BEFORE this error edge in the edge list, throws a ValueError.</li>
<li><code>((source, Exception), target)</code>: An error edge from Exception to target. The edge is traversed if the source node is executed by an incoming edge which is located BEFORE this error edge in the edge list throws an Exception. Source node lists are also supported.</li>
<li><code>(Exception, target, ErrorConfig(propagate=True))</code>: If propagate is <code>True</code>, the exception is propagated to the next error edges in the edge list. If the exception is not handled by any error edge, it is ultimately raised.</li>
</ul>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.edgygraph.graph.graphs.Graph.edges">edges</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of edges of compatible nodes that build the graph.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.edgygraph.graph.graphs.Graph.hooks">hooks</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of graph hook classes. Usable for debugging, logging and custom logic.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/edgygraph/graph/graphs.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Graph</span><span class="p">[</span><span class="n">T</span><span class="p">:</span> <span class="n">StateProtocol</span> <span class="o">=</span> <span class="n">StateProtocol</span><span class="p">,</span> <span class="n">S</span><span class="p">:</span> <span class="n">SharedProtocol</span> <span class="o">=</span> <span class="n">SharedProtocol</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create and execute a graph defined by a list of edges</span>


<span class="sd">    ## Generic Typing Parameters </span>

<span class="sd">    Use protocols or classes that extend **StateProtocol** and **SharedProtocol** or **State** and **Shared** to define the supported state types.</span>

<span class="sd">    ### Inheritance with Variance</span>

<span class="sd">    With covariance its possible to use nodes that use more specific State and Shared classes as the generic typing parameters. Requires an inheritance structure.</span>

<span class="sd">    This is recommended for smaller projects because it needs less boilerplate.</span>

<span class="sd">    ### Duck Typing</span>

<span class="sd">    For the more flexible approach with better scaling use protocols to define the supported state types. Remember to always extend `typing.Protocol` in the child classes for typing.</span>

<span class="sd">    This is recommended for scalable projects where many different state types need to be joined in one graph. See [edgynodes](https://github.com/mathisxy/edgynodes/) for an example.</span>

<span class="sd">    ### Disable Type Checking</span>

<span class="sd">    If you want to disable type checking for the graph, you can use `typing.Any` as generic typing parameters in the graph.</span>


<span class="sd">    ## Edges</span>

<span class="sd">    The edges are defined as a list of tuples, where the first element is the source and the second element reveals the next node.</span>

<span class="sd">    ### Branches</span>

<span class="sd">    The edges are contained in branches. A branch is a tuple with edges and a join parameter at the end. </span>

<span class="sd">    #### Spawning</span>

<span class="sd">    A branch is spawned when the source of the first edge of the branch is triggered.</span>

<span class="sd">    In this example it would be on `START`:</span>

<span class="sd">    ```python</span>
<span class="sd">    edges=[(</span>
<span class="sd">       (START, node1),</span>
<span class="sd">       (node1, node2),</span>
<span class="sd">       END</span>
<span class="sd">    )]</span>
<span class="sd">    ```</span>

<span class="sd">    In this example it would be on `node1` and on `node2` each:</span>

<span class="sd">    ```python</span>
<span class="sd">    edges=[(</span>
<span class="sd">       ([node1, node2], node3),</span>
<span class="sd">       node4</span>
<span class="sd">    )]</span>
<span class="sd">    ```</span>

<span class="sd">    #### Joining</span>

<span class="sd">    The join parameter can be of the following types:</span>

<span class="sd">    - `None`: The branch will not be joined.</span>
<span class="sd">    - `END`: The branch will be joined at the end of the graph.</span>
<span class="sd">    - A node instance: The branch will be joined directly before the given node is executed in any branch into this branch.</span>

<span class="sd">    The process of joining describes waiting for the branches to finish wich aim to join and then applying the changes to the state of the whole finished branch to the state of the joining branch.</span>

<span class="sd">    ### Formats</span>

<span class="sd">    A branch supports different formats for the edges.</span>

<span class="sd">    - `(source, target)`: A single edge from source to target.</span>
<span class="sd">    - `(START, target)`: A single edge from the start of the graph to target.</span>
<span class="sd">    - `(source, None)`: A single edge from source to no target. `END` is not allowed here, since it would be redundant. It is only allowed in join parameters to distinct join at the end of the graph (`END`) from not joining (`None`)</span>
<span class="sd">    - `([source1, source2], target)`: Multiple edges from source1 and source2 to target.</span>
<span class="sd">    - `(source, [target1, target2])`: Multiple edges from source to target1 and target2.</span>
<span class="sd">    - `([source1, source2], [target1, target2])`: Multiple edges from source1 and source2 to target1 and target2. This will create 4 edges in total.</span>
<span class="sd">    - `(source, lambda st, sh: [target1, target2] if sh.x)`: A dynamic edge from source to target. The function takes the state and the shared state as arguments. It must return a node, a list of nodes, END or None. Async functions are also supported. They are executed sequentially so there are no race conditions.</span>
<span class="sd">    - `(source, target, Config(instant=True))`: An instant edge from source to target. The target nodes are collected recursively and executed parallel to the source node. Make sure not to create cycles.</span>
<span class="sd">    - `(ValueError, target)`: An error edge from ValueError to target. The edge is traversed if a node, which is executed by an incoming edge located BEFORE this error edge in the edge list, throws a ValueError.</span>
<span class="sd">    - `((source, Exception), target)`: An error edge from Exception to target. The edge is traversed if the source node is executed by an incoming edge which is located BEFORE this error edge in the edge list throws an Exception. Source node lists are also supported.</span>
<span class="sd">    - `(Exception, target, ErrorConfig(propagate=True))`: If propagate is `True`, the exception is propagated to the next error edges in the edge list. If the exception is not handled by any error edge, it is ultimately raised.</span>


<span class="sd">    Attributes:</span>
<span class="sd">        edges: A list of edges of compatible nodes that build the graph.</span>
<span class="sd">        hooks: A list of graph hook classes. Usable for debugging, logging and custom logic.</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">task_group</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">TaskGroup</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;TaskGroup not initialized&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tg</span>

    <span class="n">tg</span><span class="p">:</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">TaskGroup</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>


    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
            <span class="n">edges</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">BranchContainer</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">]],</span> 
            <span class="n">hooks</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">GraphHook</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">edges</span> <span class="o">=</span> <span class="n">edges</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hooks</span> <span class="o">=</span> <span class="n">hooks</span> <span class="ow">or</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">branch_registry</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">SingleSource</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="n">Branch</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">]]]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">join_registry</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Join</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="n">Branch</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">]]]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">index_branches</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">index_branches</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">branch_container</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>

            <span class="n">source</span> <span class="o">=</span> <span class="n">branch_container</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">Types</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">]</span><span class="o">.</span><span class="n">is_single_source</span><span class="p">(</span><span class="n">source</span><span class="p">):</span>

                <span class="n">branch</span> <span class="o">=</span> <span class="n">Branch</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">](</span><span class="n">branch_container</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">source</span><span class="p">,</span> <span class="n">branch_container</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">branch_registry</span><span class="p">[</span><span class="n">source</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">branch</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">Types</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">]</span><span class="o">.</span><span class="n">is_single_source_sequence</span><span class="p">(</span><span class="n">source</span><span class="p">):</span>

                <span class="k">for</span> <span class="n">start_node</span> <span class="ow">in</span> <span class="n">source</span><span class="p">:</span>

                    <span class="n">branch</span> <span class="o">=</span> <span class="n">Branch</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">](</span><span class="n">branch_container</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">start_node</span><span class="p">,</span> <span class="n">branch_container</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">branch_registry</span><span class="p">[</span><span class="n">start_node</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">branch</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid source type: </span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">branch_registry</span><span class="p">)</span>


    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span> <span class="n">shared</span><span class="p">:</span> <span class="n">S</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run the graph on the given state and shared state.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Hook</span>
        <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hooks</span><span class="p">:</span> <span class="k">await</span> <span class="n">h</span><span class="o">.</span><span class="n">on_graph_start</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">shared</span><span class="p">)</span>

        <span class="k">async</span> <span class="k">with</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">TaskGroup</span><span class="p">()</span> <span class="k">as</span> <span class="n">tg</span><span class="p">:</span>

            <span class="c1"># Initialization</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tg</span> <span class="o">=</span> <span class="n">tg</span>

            <span class="k">for</span> <span class="n">branch</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">branch_registry</span><span class="p">[</span><span class="n">START</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spawn_branch</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">shared</span><span class="p">,</span> <span class="n">branch</span><span class="p">)</span>

        <span class="n">state_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Hashable</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="n">Hashable</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">state</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>

        <span class="k">for</span> <span class="n">branch</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">join_registry</span><span class="p">[</span><span class="n">END</span><span class="p">]:</span>

            <span class="k">if</span> <span class="n">branch</span><span class="o">.</span><span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Branch result is None: </span><span class="si">{</span><span class="n">branch</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">changes</span> <span class="o">=</span> <span class="k">await</span> <span class="n">branch</span><span class="o">.</span><span class="n">result</span>

            <span class="n">Diff</span><span class="o">.</span><span class="n">apply_changes</span><span class="p">(</span><span class="n">state_dict</span><span class="p">,</span> <span class="n">changes</span><span class="p">)</span>

        <span class="c1"># Final state</span>
        <span class="n">final_state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">state_dict</span><span class="p">)</span>

        <span class="c1"># Hook</span>
        <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hooks</span><span class="p">:</span> <span class="k">await</span> <span class="n">h</span><span class="o">.</span><span class="n">on_graph_end</span><span class="p">(</span><span class="n">final_state</span><span class="p">,</span> <span class="n">shared</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">final_state</span><span class="p">,</span> <span class="n">shared</span>



    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run_branch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span> <span class="n">shared</span><span class="p">:</span> <span class="n">S</span><span class="p">,</span> <span class="n">branch</span><span class="p">:</span> <span class="n">Branch</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Execute the branch based on the edges</span>

<span class="sd">        Args:</span>
<span class="sd">            state: State of the first generic type of the graph or a subtype</span>
<span class="sd">            shared: Shared of the second generic type of the graph or a subtype</span>

<span class="sd">        Returns:</span>
<span class="sd">            New State instance and the same Shared instance</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">branch</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Future</span><span class="p">()</span>

        <span class="n">initial_state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">model_copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="n">next_nodes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">NextNode</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">]]</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_next</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">shared</span><span class="p">,</span> <span class="n">branch</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">branch</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;INITIAL NEXT:&quot;</span><span class="p">,</span> <span class="n">next_nodes</span><span class="p">)</span>


            <span class="k">while</span> <span class="n">next_nodes</span><span class="p">:</span>

                <span class="c1"># Hook</span>
                <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hooks</span><span class="p">:</span> <span class="k">await</span> <span class="n">h</span><span class="o">.</span><span class="n">on_step_start</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">shared</span><span class="p">,</span> <span class="n">next_nodes</span><span class="p">)</span>

                <span class="c1"># Run parallel</span>
                <span class="n">result_states</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">T</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">spawn_branches</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">shared</span><span class="p">,</span> <span class="n">next_nodes</span><span class="p">)</span>

                <span class="n">state</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">join_branches</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">next_nodes</span><span class="p">)</span>

                <span class="k">try</span><span class="p">:</span>

                    <span class="k">async</span> <span class="k">with</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">TaskGroup</span><span class="p">()</span> <span class="k">as</span> <span class="n">tg</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">next_nodes</span><span class="p">:</span>

                            <span class="n">state_copy</span><span class="p">:</span> <span class="n">T</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">model_copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                            <span class="n">result_states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state_copy</span><span class="p">)</span>

                            <span class="n">tg</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_wrapper</span><span class="p">(</span><span class="n">state_copy</span><span class="p">,</span> <span class="n">shared</span><span class="p">,</span> <span class="n">node</span><span class="p">))</span>

                    <span class="c1"># Merge</span>
                    <span class="n">state</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">merge_states</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">result_states</span><span class="p">)</span>


                <span class="k">except</span> <span class="n">ExceptionGroup</span> <span class="k">as</span> <span class="n">eg</span><span class="p">:</span>

                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">eg</span><span class="p">)</span>

                    <span class="n">next_nodes</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_next_from_error</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">shared</span><span class="p">,</span> <span class="n">eg</span><span class="p">,</span> <span class="n">branch</span><span class="p">)</span>

                    <span class="nb">print</span><span class="p">(</span><span class="n">next_nodes</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>

                    <span class="n">next_nodes</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_next</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">shared</span><span class="p">,</span> <span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">node</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">next_nodes</span><span class="p">],</span> <span class="n">branch</span><span class="p">)</span>

                <span class="k">finally</span><span class="p">:</span>

                    <span class="c1"># Hook</span>
                    <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hooks</span><span class="p">:</span> <span class="k">await</span> <span class="n">h</span><span class="o">.</span><span class="n">on_step_end</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">shared</span><span class="p">,</span> <span class="n">next_nodes</span><span class="p">)</span>


        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

            <span class="c1"># Hook</span>
            <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hooks</span><span class="p">:</span>
                <span class="n">e</span> <span class="o">=</span> <span class="k">await</span> <span class="n">h</span><span class="o">.</span><span class="n">on_error</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">shared</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">e</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> 
                    <span class="k">break</span>

            <span class="k">if</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">e</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; --- BRANCH RESULT --- &quot;</span><span class="p">)</span>

        <span class="n">branch</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">set_result</span><span class="p">(</span><span class="n">Diff</span><span class="o">.</span><span class="n">recursive_diff</span><span class="p">(</span><span class="n">initial_state</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(),</span> <span class="n">state</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()))</span>



    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">node_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span> <span class="n">shared</span><span class="p">:</span> <span class="n">S</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">NextNode</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wrapper for the nodes to catch exceptions and add the node to the exception with the key: `source_node`.</span>

<span class="sd">        This is used to determine the node that caused the exception.</span>
<span class="sd">        This is used in the `get_next_nodes_from_error` method to determine the next nodes to execute.</span>

<span class="sd">        Args:</span>
<span class="sd">            state: The state of the graph.</span>
<span class="sd">            shared: The shared state of the graph.</span>
<span class="sd">            node: The node to execute.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">node</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">shared</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">e</span><span class="o">.</span><span class="n">source_node</span> <span class="o">=</span> <span class="n">node</span> <span class="c1"># type: ignore</span>
            <span class="k">raise</span> <span class="n">e</span>



    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">merge_states</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_state</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span> <span class="n">result_states</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Merges the result states into the current state.</span>
<span class="sd">        First the changes are calculated for each result state.</span>
<span class="sd">        Then the changes are checked for conflicts.</span>
<span class="sd">        If there are conflicts, a ChangeConflictException is raised.</span>
<span class="sd">        The changes are applied in the order of the result states list.</span>

<span class="sd">        Args:</span>
<span class="sd">            current_state: The current state</span>
<span class="sd">            result_states: The result states</span>

<span class="sd">        Returns:</span>
<span class="sd">            The new merged State instance.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ChangeConflictException: If there are conflicts in the changes.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">result_dicts</span> <span class="o">=</span> <span class="p">[</span><span class="n">state</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span> <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">result_states</span><span class="p">]</span>
        <span class="n">current_dict</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="n">Hashable</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">current_state</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>

        <span class="n">changes_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Hashable</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">Change</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>


        <span class="k">for</span> <span class="n">result_dict</span> <span class="ow">in</span> <span class="n">result_dicts</span><span class="p">:</span>

            <span class="n">changes_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Diff</span><span class="o">.</span><span class="n">recursive_diff</span><span class="p">(</span><span class="n">current_dict</span><span class="p">,</span> <span class="n">result_dict</span><span class="p">))</span>


        <span class="c1"># Hook</span>
        <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hooks</span><span class="p">:</span> <span class="k">await</span> <span class="n">h</span><span class="o">.</span><span class="n">on_merge_start</span><span class="p">(</span><span class="n">current_state</span><span class="p">,</span> <span class="n">result_states</span><span class="p">,</span> <span class="n">changes_list</span><span class="p">)</span>


        <span class="n">state</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_changes</span><span class="p">(</span><span class="n">current_state</span><span class="p">,</span> <span class="n">changes_list</span><span class="p">)</span>


        <span class="c1"># Hook</span>
        <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hooks</span><span class="p">:</span> <span class="k">await</span> <span class="n">h</span><span class="o">.</span><span class="n">on_merge_end</span><span class="p">(</span><span class="n">current_state</span><span class="p">,</span> <span class="n">result_states</span><span class="p">,</span> <span class="n">changes_list</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">state</span>


    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">apply_changes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span> <span class="n">changes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Hashable</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">Change</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply changes to the state.</span>

<span class="sd">        Args:</span>
<span class="sd">            state: The current state.</span>
<span class="sd">            changes: A list of changes to apply.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ChangeConflictException: If there are conflicts in the changes.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">state_dict</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="n">Hashable</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">state</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>
        <span class="n">conflicts</span> <span class="o">=</span> <span class="n">Diff</span><span class="o">.</span><span class="n">find_conflicts</span><span class="p">(</span><span class="n">changes</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">conflicts</span><span class="p">:</span>

            <span class="c1"># Hook</span>
            <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hooks</span><span class="p">:</span> <span class="k">await</span> <span class="n">h</span><span class="o">.</span><span class="n">on_merge_conflict</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">changes</span><span class="p">,</span> <span class="n">conflicts</span><span class="p">)</span>

            <span class="k">raise</span> <span class="n">ChangeConflictException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Conflicts detected: </span><span class="si">{</span><span class="n">conflicts</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


        <span class="k">for</span> <span class="n">change</span> <span class="ow">in</span> <span class="n">changes</span><span class="p">:</span>
            <span class="n">Diff</span><span class="o">.</span><span class="n">apply_changes</span><span class="p">(</span><span class="n">state_dict</span><span class="p">,</span> <span class="n">change</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">state</span><span class="p">)</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">state_dict</span><span class="p">)</span>


    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">spawn_branches</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span> <span class="n">shared</span><span class="p">:</span> <span class="n">S</span><span class="p">,</span> <span class="n">next_nodes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">NextNode</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Spawn branches based on the next nodes.</span>

<span class="sd">        Args:</span>
<span class="sd">            state: The state of the graph.</span>
<span class="sd">            next_nodes: The source nodes of the branches to execute.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">next_nodes</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">branch</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">branch_registry</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">node</span><span class="p">]:</span>

                <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hooks</span><span class="p">:</span> <span class="k">await</span> <span class="n">h</span><span class="o">.</span><span class="n">on_spawn_branch_start</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">shared</span><span class="p">,</span> <span class="n">branch</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">branch_registry</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">join_registry</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">spawn_branch</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">shared</span><span class="p">,</span> <span class="n">branch</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hooks</span><span class="p">:</span> <span class="k">await</span> <span class="n">h</span><span class="o">.</span><span class="n">on_spawn_branch_end</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">shared</span><span class="p">,</span> <span class="n">branch</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">branch_registry</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">join_registry</span><span class="p">)</span>



    <span class="k">def</span><span class="w"> </span><span class="nf">spawn_branch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span> <span class="n">shared</span><span class="p">:</span> <span class="n">S</span><span class="p">,</span> <span class="n">branch</span><span class="p">:</span> <span class="n">Branch</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">join_registry</span><span class="p">[</span><span class="n">branch</span><span class="o">.</span><span class="n">join</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">branch</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">task_group</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">run_branch</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">shared</span><span class="p">,</span> <span class="n">branch</span><span class="p">))</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">join_branches</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span> <span class="n">next_nodes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">NextNode</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Join all branches that join on one of the next nodes.</span>

<span class="sd">        Args:</span>
<span class="sd">            state: The state of the graph.</span>
<span class="sd">            next_nodes: The next nodes to execute.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The merged state of the graph after joining the branches.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">changes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Hashable</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">Change</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">next_nodes</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">branch</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">join_registry</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">node</span><span class="p">]:</span>

                <span class="k">if</span> <span class="n">branch</span><span class="o">.</span><span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Branch </span><span class="si">{</span><span class="n">branch</span><span class="si">}</span><span class="s2"> has no result&quot;</span><span class="p">)</span>

                <span class="n">changes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="k">await</span> <span class="n">branch</span><span class="o">.</span><span class="n">result</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">join_registry</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">node</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">branch</span><span class="p">)</span>

        <span class="n">state</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_changes</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">changes</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">state</span>



    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_next</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span> <span class="n">shared</span><span class="p">:</span> <span class="n">S</span><span class="p">,</span> <span class="n">current_nodes</span><span class="p">:</span> <span class="n">Source</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">],</span> <span class="n">branch</span><span class="p">:</span> <span class="n">Branch</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">NextNode</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the next nodes to run based on the current nodes and the graph&#39;s edges.</span>

<span class="sd">        Callable edges are called with the state and shared state.</span>

<span class="sd">        Args:</span>
<span class="sd">            state: The current state</span>
<span class="sd">            shared: The shared state</span>
<span class="sd">            current_nodes: The current nodes</span>

<span class="sd">        Returns:</span>
<span class="sd">           The list of the next nodes including their edges that they were reached by.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;GET NEXT FOR CURRENT NODES: </span><span class="si">{</span><span class="n">current_nodes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">next_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">NextNode</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">Types</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">]</span><span class="o">.</span><span class="n">is_single_source_sequence</span><span class="p">(</span><span class="n">current_nodes</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;IS SINGLE SOURCE SEQUENCE&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">current_node</span> <span class="ow">in</span> <span class="n">current_nodes</span><span class="p">:</span>
                <span class="n">next_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolve_entries</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">shared</span><span class="p">,</span> <span class="n">branch</span><span class="o">.</span><span class="n">edge_index</span><span class="p">[</span><span class="n">current_node</span><span class="p">])</span>
                <span class="p">)</span>

        <span class="k">elif</span> <span class="n">Types</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">]</span><span class="o">.</span><span class="n">is_single_source</span><span class="p">(</span><span class="n">current_nodes</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;IS SINGLE SOURCE&quot;</span><span class="p">)</span>
            <span class="n">next_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolve_entries</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">shared</span><span class="p">,</span> <span class="n">branch</span><span class="o">.</span><span class="n">edge_index</span><span class="p">[</span><span class="n">current_nodes</span><span class="p">])</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid current_nodes type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">current_nodes</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


        <span class="c1"># Instant nodes</span>
        <span class="n">current_instant_next_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">NextNode</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>

            <span class="n">current_entries</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">entry</span>
                <span class="k">for</span> <span class="nb">next</span> <span class="ow">in</span> <span class="n">current_instant_next_list</span> 
                <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">branch</span><span class="o">.</span><span class="n">edge_index</span><span class="p">[</span><span class="nb">next</span><span class="o">.</span><span class="n">node</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">instant</span>
            <span class="p">]</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">current_entries</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="n">current_instant_next_list</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolve_entries</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">shared</span><span class="p">,</span> <span class="n">current_entries</span><span class="p">)</span>
            <span class="n">next_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">current_instant_next_list</span><span class="p">)</span>


        <span class="k">return</span> <span class="n">next_list</span>



    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_next_from_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span> <span class="n">shared</span><span class="p">:</span> <span class="n">S</span><span class="p">,</span> <span class="n">eg</span><span class="p">:</span> <span class="n">ExceptionGroup</span><span class="p">,</span> <span class="n">branch</span><span class="p">:</span> <span class="n">Branch</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">NextNode</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the next nodes to execute from the error.</span>

<span class="sd">        If exceptions in the group dont have the key `source_node` they will be reraised as an Exception group.</span>

<span class="sd">        Args:</span>
<span class="sd">            state: The state of the graph.</span>
<span class="sd">            shared: The shared state of the graph.</span>
<span class="sd">            eg: The exception group with all errors to get the next nodes from.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The next nodes to execute.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">next_nodes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">NextNode</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">unhandled</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">eg</span><span class="o">.</span><span class="n">exceptions</span><span class="p">:</span>

            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>


            <span class="n">source_node</span><span class="p">:</span> <span class="n">NextNode</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="s2">&quot;source_node&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source_node</span><span class="p">,</span> <span class="n">NextNode</span><span class="p">):</span>
                <span class="n">unhandled</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="n">entries</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ErrorEntry</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">branch</span><span class="o">.</span><span class="n">error_edge_index</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">match_error</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">source_node</span><span class="p">):</span>
                    <span class="n">entries</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">branch</span><span class="o">.</span><span class="n">error_edge_index</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

            <span class="n">entries</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;</span> <span class="n">source_node</span><span class="o">.</span><span class="n">reached_by</span><span class="o">.</span><span class="n">index</span><span class="p">:</span> <span class="c1"># If the error entry is after the node that raised the error</span>
                    <span class="n">next_nodes</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolve_entries</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">shared</span><span class="p">,</span> <span class="p">[</span><span class="n">entry</span><span class="p">])</span>
                    <span class="p">)</span>

                    <span class="nb">print</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">entry</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">propagate</span><span class="p">:</span>
                        <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span> <span class="c1"># Not consumed</span>
                <span class="n">unhandled</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">unhandled</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExceptionGroup</span><span class="p">(</span><span class="s2">&quot;Unhandled node exceptions&quot;</span><span class="p">,</span> <span class="n">unhandled</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">next_nodes</span>



    <span class="k">def</span><span class="w"> </span><span class="nf">match_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="n">SingleErrorSource</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">],</span> <span class="n">source_node</span><span class="p">:</span> <span class="n">NextNode</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>

        <span class="k">match</span> <span class="n">source</span><span class="p">:</span>
            <span class="k">case</span> <span class="nb">type</span><span class="p">():</span> <span class="c1"># Exception type</span>
                <span class="k">return</span> <span class="nb">issubclass</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">source</span><span class="p">)</span>
            <span class="k">case</span> <span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">error_type</span><span class="p">):</span> <span class="c1"># (Node, Exception type)</span>
                <span class="k">return</span> <span class="n">node</span> <span class="o">==</span> <span class="n">source_node</span><span class="o">.</span><span class="n">node</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">error_type</span><span class="p">)</span>


    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">resolve_entries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span> <span class="n">shared</span><span class="p">:</span> <span class="n">S</span><span class="p">,</span> <span class="n">entries</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Entries</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">NextNode</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">]]:</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RESOLVE: </span><span class="si">{</span><span class="n">entries</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">[</span>
            <span class="n">next_node</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span>
            <span class="k">for</span> <span class="n">next_node</span> <span class="ow">in</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolve_entry</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">shared</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span>
        <span class="p">]</span>


    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">resolve_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span> <span class="n">shared</span><span class="p">:</span> <span class="n">S</span><span class="p">,</span> <span class="n">entry</span><span class="p">:</span> <span class="n">Entries</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">NextNode</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resolve the next to nodes.</span>

<span class="sd">        Make sure to ONLY call this method ONCE per execution of the corresponding edge.</span>

<span class="sd">        Args:</span>
<span class="sd">            state: The current state.</span>
<span class="sd">            shared: The shared state.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The resolved nodes.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RESOLVING: </span><span class="si">{</span><span class="n">entry</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="nb">next</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">next</span>



        <span class="k">if</span> <span class="ow">not</span> <span class="n">Types</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">]</span><span class="o">.</span><span class="n">is_resolved_next</span><span class="p">(</span><span class="nb">next</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CALLABLE&quot;</span><span class="p">)</span>
            <span class="nb">next</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Callable</span><span class="p">[[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">],</span> <span class="n">ResolvedNext</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">]],</span> <span class="nb">next</span><span class="p">)</span>
            <span class="nb">next</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">shared</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isawaitable</span><span class="p">(</span><span class="nb">next</span><span class="p">):</span>
                <span class="nb">next</span> <span class="o">=</span> <span class="k">await</span> <span class="nb">next</span>


        <span class="k">return</span> <span class="p">[</span>
            <span class="n">NextNode</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">](</span><span class="n">node</span><span class="o">=</span><span class="n">node</span><span class="p">,</span> <span class="n">reached_by</span><span class="o">=</span><span class="n">entry</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_next_nodes</span><span class="p">(</span><span class="nb">next</span><span class="p">)</span>
        <span class="p">]</span>



    <span class="k">def</span><span class="w"> </span><span class="nf">get_next_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">next</span><span class="p">:</span> <span class="n">ResolvedNext</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">]]:</span>

        <span class="n">next_nodes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">match</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">SingleNext</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

            <span class="k">match</span> <span class="n">x</span><span class="p">:</span>

                <span class="k">case</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;None&quot;</span><span class="p">)</span>
                    <span class="k">pass</span>

                <span class="k">case</span> <span class="n">Node</span><span class="p">():</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Node&quot;</span><span class="p">)</span>
                    <span class="n">next_nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">Types</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">]</span><span class="o">.</span><span class="n">is_single_next_sequence</span><span class="p">(</span><span class="nb">next</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sequence&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">next</span><span class="p">:</span>
                <span class="k">match</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">Types</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">]</span><span class="o">.</span><span class="n">is_single_next</span><span class="p">(</span><span class="nb">next</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Single&quot;</span><span class="p">)</span>
            <span class="k">match</span><span class="p">(</span><span class="nb">next</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">next_nodes</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="src.edgygraph.graph.graphs.Graph.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">shared</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Run the graph on the given state and shared state.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/edgygraph/graph/graphs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span> <span class="n">shared</span><span class="p">:</span> <span class="n">S</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run the graph on the given state and shared state.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Hook</span>
    <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hooks</span><span class="p">:</span> <span class="k">await</span> <span class="n">h</span><span class="o">.</span><span class="n">on_graph_start</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">shared</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">with</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">TaskGroup</span><span class="p">()</span> <span class="k">as</span> <span class="n">tg</span><span class="p">:</span>

        <span class="c1"># Initialization</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tg</span> <span class="o">=</span> <span class="n">tg</span>

        <span class="k">for</span> <span class="n">branch</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">branch_registry</span><span class="p">[</span><span class="n">START</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spawn_branch</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">shared</span><span class="p">,</span> <span class="n">branch</span><span class="p">)</span>

    <span class="n">state_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Hashable</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="n">Hashable</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">state</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>

    <span class="k">for</span> <span class="n">branch</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">join_registry</span><span class="p">[</span><span class="n">END</span><span class="p">]:</span>

        <span class="k">if</span> <span class="n">branch</span><span class="o">.</span><span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Branch result is None: </span><span class="si">{</span><span class="n">branch</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">changes</span> <span class="o">=</span> <span class="k">await</span> <span class="n">branch</span><span class="o">.</span><span class="n">result</span>

        <span class="n">Diff</span><span class="o">.</span><span class="n">apply_changes</span><span class="p">(</span><span class="n">state_dict</span><span class="p">,</span> <span class="n">changes</span><span class="p">)</span>

    <span class="c1"># Final state</span>
    <span class="n">final_state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">state_dict</span><span class="p">)</span>

    <span class="c1"># Hook</span>
    <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hooks</span><span class="p">:</span> <span class="k">await</span> <span class="n">h</span><span class="o">.</span><span class="n">on_graph_end</span><span class="p">(</span><span class="n">final_state</span><span class="p">,</span> <span class="n">shared</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">final_state</span><span class="p">,</span> <span class="n">shared</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.edgygraph.graph.graphs.Graph.run_branch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run_branch</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">shared</span><span class="p">,</span> <span class="n">branch</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Execute the branch based on the edges</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><span title="src.edgygraph.graph.graphs.Graph[T]">T</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>State of the first generic type of the graph or a subtype</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>shared</code>
            </td>
            <td>
                  <code><span title="src.edgygraph.graph.graphs.Graph[S]">S</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Shared of the second generic type of the graph or a subtype</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>New State instance and the same Shared instance</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/edgygraph/graph/graphs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run_branch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span> <span class="n">shared</span><span class="p">:</span> <span class="n">S</span><span class="p">,</span> <span class="n">branch</span><span class="p">:</span> <span class="n">Branch</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Execute the branch based on the edges</span>

<span class="sd">    Args:</span>
<span class="sd">        state: State of the first generic type of the graph or a subtype</span>
<span class="sd">        shared: Shared of the second generic type of the graph or a subtype</span>

<span class="sd">    Returns:</span>
<span class="sd">        New State instance and the same Shared instance</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">branch</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Future</span><span class="p">()</span>

    <span class="n">initial_state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">model_copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>

        <span class="n">next_nodes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">NextNode</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">]]</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_next</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">shared</span><span class="p">,</span> <span class="n">branch</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">branch</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;INITIAL NEXT:&quot;</span><span class="p">,</span> <span class="n">next_nodes</span><span class="p">)</span>


        <span class="k">while</span> <span class="n">next_nodes</span><span class="p">:</span>

            <span class="c1"># Hook</span>
            <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hooks</span><span class="p">:</span> <span class="k">await</span> <span class="n">h</span><span class="o">.</span><span class="n">on_step_start</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">shared</span><span class="p">,</span> <span class="n">next_nodes</span><span class="p">)</span>

            <span class="c1"># Run parallel</span>
            <span class="n">result_states</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">T</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">spawn_branches</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">shared</span><span class="p">,</span> <span class="n">next_nodes</span><span class="p">)</span>

            <span class="n">state</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">join_branches</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">next_nodes</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>

                <span class="k">async</span> <span class="k">with</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">TaskGroup</span><span class="p">()</span> <span class="k">as</span> <span class="n">tg</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">next_nodes</span><span class="p">:</span>

                        <span class="n">state_copy</span><span class="p">:</span> <span class="n">T</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">model_copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="n">result_states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state_copy</span><span class="p">)</span>

                        <span class="n">tg</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_wrapper</span><span class="p">(</span><span class="n">state_copy</span><span class="p">,</span> <span class="n">shared</span><span class="p">,</span> <span class="n">node</span><span class="p">))</span>

                <span class="c1"># Merge</span>
                <span class="n">state</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">merge_states</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">result_states</span><span class="p">)</span>


            <span class="k">except</span> <span class="n">ExceptionGroup</span> <span class="k">as</span> <span class="n">eg</span><span class="p">:</span>

                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">eg</span><span class="p">)</span>

                <span class="n">next_nodes</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_next_from_error</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">shared</span><span class="p">,</span> <span class="n">eg</span><span class="p">,</span> <span class="n">branch</span><span class="p">)</span>

                <span class="nb">print</span><span class="p">(</span><span class="n">next_nodes</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="n">next_nodes</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_next</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">shared</span><span class="p">,</span> <span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">node</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">next_nodes</span><span class="p">],</span> <span class="n">branch</span><span class="p">)</span>

            <span class="k">finally</span><span class="p">:</span>

                <span class="c1"># Hook</span>
                <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hooks</span><span class="p">:</span> <span class="k">await</span> <span class="n">h</span><span class="o">.</span><span class="n">on_step_end</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">shared</span><span class="p">,</span> <span class="n">next_nodes</span><span class="p">)</span>


    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

        <span class="c1"># Hook</span>
        <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hooks</span><span class="p">:</span>
            <span class="n">e</span> <span class="o">=</span> <span class="k">await</span> <span class="n">h</span><span class="o">.</span><span class="n">on_error</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">shared</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">e</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> 
                <span class="k">break</span>

        <span class="k">if</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">e</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; --- BRANCH RESULT --- &quot;</span><span class="p">)</span>

    <span class="n">branch</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">set_result</span><span class="p">(</span><span class="n">Diff</span><span class="o">.</span><span class="n">recursive_diff</span><span class="p">(</span><span class="n">initial_state</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(),</span> <span class="n">state</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.edgygraph.graph.graphs.Graph.node_wrapper" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">node_wrapper</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">shared</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Wrapper for the nodes to catch exceptions and add the node to the exception with the key: <code>source_node</code>.</p>
<p>This is used to determine the node that caused the exception.
This is used in the <code>get_next_nodes_from_error</code> method to determine the next nodes to execute.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><span title="src.edgygraph.graph.graphs.Graph[T]">T</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The state of the graph.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>shared</code>
            </td>
            <td>
                  <code><span title="src.edgygraph.graph.graphs.Graph[S]">S</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The shared state of the graph.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>node</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="NextNode (src.edgygraph.graph.types.NextNode)" href="../types/#src.edgygraph.graph.types.NextNode">NextNode</a>[<span title="src.edgygraph.graph.graphs.Graph[T]">T</span>, <span title="src.edgygraph.graph.graphs.Graph[S]">S</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The node to execute.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/edgygraph/graph/graphs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">node_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span> <span class="n">shared</span><span class="p">:</span> <span class="n">S</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">NextNode</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wrapper for the nodes to catch exceptions and add the node to the exception with the key: `source_node`.</span>

<span class="sd">    This is used to determine the node that caused the exception.</span>
<span class="sd">    This is used in the `get_next_nodes_from_error` method to determine the next nodes to execute.</span>

<span class="sd">    Args:</span>
<span class="sd">        state: The state of the graph.</span>
<span class="sd">        shared: The shared state of the graph.</span>
<span class="sd">        node: The node to execute.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">await</span> <span class="n">node</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">shared</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">e</span><span class="o">.</span><span class="n">source_node</span> <span class="o">=</span> <span class="n">node</span> <span class="c1"># type: ignore</span>
        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.edgygraph.graph.graphs.Graph.merge_states" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">merge_states</span><span class="p">(</span><span class="n">current_state</span><span class="p">,</span> <span class="n">result_states</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Merges the result states into the current state.
First the changes are calculated for each result state.
Then the changes are checked for conflicts.
If there are conflicts, a ChangeConflictException is raised.
The changes are applied in the order of the result states list.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>current_state</code>
            </td>
            <td>
                  <code><span title="src.edgygraph.graph.graphs.Graph[T]">T</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The current state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>result_states</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="src.edgygraph.graph.graphs.Graph[T]">T</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The result states</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="src.edgygraph.graph.graphs.Graph[T]">T</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The new merged State instance.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="ChangeConflictException (src.edgygraph.diff.ChangeConflictException)" href="../../diff/#src.edgygraph.diff.ChangeConflictException">ChangeConflictException</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If there are conflicts in the changes.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/edgygraph/graph/graphs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">merge_states</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_state</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span> <span class="n">result_states</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Merges the result states into the current state.</span>
<span class="sd">    First the changes are calculated for each result state.</span>
<span class="sd">    Then the changes are checked for conflicts.</span>
<span class="sd">    If there are conflicts, a ChangeConflictException is raised.</span>
<span class="sd">    The changes are applied in the order of the result states list.</span>

<span class="sd">    Args:</span>
<span class="sd">        current_state: The current state</span>
<span class="sd">        result_states: The result states</span>

<span class="sd">    Returns:</span>
<span class="sd">        The new merged State instance.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ChangeConflictException: If there are conflicts in the changes.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">result_dicts</span> <span class="o">=</span> <span class="p">[</span><span class="n">state</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span> <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">result_states</span><span class="p">]</span>
    <span class="n">current_dict</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="n">Hashable</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">current_state</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>

    <span class="n">changes_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Hashable</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">Change</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>


    <span class="k">for</span> <span class="n">result_dict</span> <span class="ow">in</span> <span class="n">result_dicts</span><span class="p">:</span>

        <span class="n">changes_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Diff</span><span class="o">.</span><span class="n">recursive_diff</span><span class="p">(</span><span class="n">current_dict</span><span class="p">,</span> <span class="n">result_dict</span><span class="p">))</span>


    <span class="c1"># Hook</span>
    <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hooks</span><span class="p">:</span> <span class="k">await</span> <span class="n">h</span><span class="o">.</span><span class="n">on_merge_start</span><span class="p">(</span><span class="n">current_state</span><span class="p">,</span> <span class="n">result_states</span><span class="p">,</span> <span class="n">changes_list</span><span class="p">)</span>


    <span class="n">state</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_changes</span><span class="p">(</span><span class="n">current_state</span><span class="p">,</span> <span class="n">changes_list</span><span class="p">)</span>


    <span class="c1"># Hook</span>
    <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hooks</span><span class="p">:</span> <span class="k">await</span> <span class="n">h</span><span class="o">.</span><span class="n">on_merge_end</span><span class="p">(</span><span class="n">current_state</span><span class="p">,</span> <span class="n">result_states</span><span class="p">,</span> <span class="n">changes_list</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.edgygraph.graph.graphs.Graph.apply_changes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">apply_changes</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">changes</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Apply changes to the state.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><span title="src.edgygraph.graph.graphs.Graph[T]">T</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The current state.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>changes</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="dict">dict</span>[<span title="tuple">tuple</span>[<span title="collections.abc.Hashable">Hashable</span>, ...], <a class="autorefs autorefs-internal" title="Change (src.edgygraph.diff.Change)" href="../../diff/#src.edgygraph.diff.Change">Change</a>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of changes to apply.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="ChangeConflictException (src.edgygraph.diff.ChangeConflictException)" href="../../diff/#src.edgygraph.diff.ChangeConflictException">ChangeConflictException</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If there are conflicts in the changes.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/edgygraph/graph/graphs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">apply_changes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span> <span class="n">changes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Hashable</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">Change</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Apply changes to the state.</span>

<span class="sd">    Args:</span>
<span class="sd">        state: The current state.</span>
<span class="sd">        changes: A list of changes to apply.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ChangeConflictException: If there are conflicts in the changes.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">state_dict</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="n">Hashable</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">state</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>
    <span class="n">conflicts</span> <span class="o">=</span> <span class="n">Diff</span><span class="o">.</span><span class="n">find_conflicts</span><span class="p">(</span><span class="n">changes</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">conflicts</span><span class="p">:</span>

        <span class="c1"># Hook</span>
        <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hooks</span><span class="p">:</span> <span class="k">await</span> <span class="n">h</span><span class="o">.</span><span class="n">on_merge_conflict</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">changes</span><span class="p">,</span> <span class="n">conflicts</span><span class="p">)</span>

        <span class="k">raise</span> <span class="n">ChangeConflictException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Conflicts detected: </span><span class="si">{</span><span class="n">conflicts</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


    <span class="k">for</span> <span class="n">change</span> <span class="ow">in</span> <span class="n">changes</span><span class="p">:</span>
        <span class="n">Diff</span><span class="o">.</span><span class="n">apply_changes</span><span class="p">(</span><span class="n">state_dict</span><span class="p">,</span> <span class="n">change</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">state</span><span class="p">)</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">state_dict</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.edgygraph.graph.graphs.Graph.spawn_branches" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">spawn_branches</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">shared</span><span class="p">,</span> <span class="n">next_nodes</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Spawn branches based on the next nodes.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><span title="src.edgygraph.graph.graphs.Graph[T]">T</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The state of the graph.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>next_nodes</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="NextNode (src.edgygraph.graph.types.NextNode)" href="../types/#src.edgygraph.graph.types.NextNode">NextNode</a>[<span title="src.edgygraph.graph.graphs.Graph[T]">T</span>, <span title="src.edgygraph.graph.graphs.Graph[S]">S</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The source nodes of the branches to execute.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/edgygraph/graph/graphs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">spawn_branches</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span> <span class="n">shared</span><span class="p">:</span> <span class="n">S</span><span class="p">,</span> <span class="n">next_nodes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">NextNode</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Spawn branches based on the next nodes.</span>

<span class="sd">    Args:</span>
<span class="sd">        state: The state of the graph.</span>
<span class="sd">        next_nodes: The source nodes of the branches to execute.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">next_nodes</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">branch</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">branch_registry</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">node</span><span class="p">]:</span>

            <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hooks</span><span class="p">:</span> <span class="k">await</span> <span class="n">h</span><span class="o">.</span><span class="n">on_spawn_branch_start</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">shared</span><span class="p">,</span> <span class="n">branch</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">branch_registry</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">join_registry</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">spawn_branch</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">shared</span><span class="p">,</span> <span class="n">branch</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hooks</span><span class="p">:</span> <span class="k">await</span> <span class="n">h</span><span class="o">.</span><span class="n">on_spawn_branch_end</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">shared</span><span class="p">,</span> <span class="n">branch</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">branch_registry</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">join_registry</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.edgygraph.graph.graphs.Graph.join_branches" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">join_branches</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">next_nodes</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Join all branches that join on one of the next nodes.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><span title="src.edgygraph.graph.graphs.Graph[T]">T</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The state of the graph.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>next_nodes</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="NextNode (src.edgygraph.graph.types.NextNode)" href="../types/#src.edgygraph.graph.types.NextNode">NextNode</a>[<span title="src.edgygraph.graph.graphs.Graph[T]">T</span>, <span title="src.edgygraph.graph.graphs.Graph[S]">S</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The next nodes to execute.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="src.edgygraph.graph.graphs.Graph[T]">T</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The merged state of the graph after joining the branches.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/edgygraph/graph/graphs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">join_branches</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span> <span class="n">next_nodes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">NextNode</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Join all branches that join on one of the next nodes.</span>

<span class="sd">    Args:</span>
<span class="sd">        state: The state of the graph.</span>
<span class="sd">        next_nodes: The next nodes to execute.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The merged state of the graph after joining the branches.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">changes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Hashable</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">Change</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">next_nodes</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">branch</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">join_registry</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">node</span><span class="p">]:</span>

            <span class="k">if</span> <span class="n">branch</span><span class="o">.</span><span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Branch </span><span class="si">{</span><span class="n">branch</span><span class="si">}</span><span class="s2"> has no result&quot;</span><span class="p">)</span>

            <span class="n">changes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="k">await</span> <span class="n">branch</span><span class="o">.</span><span class="n">result</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">join_registry</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">node</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">branch</span><span class="p">)</span>

    <span class="n">state</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_changes</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">changes</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.edgygraph.graph.graphs.Graph.get_next" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_next</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">shared</span><span class="p">,</span> <span class="n">current_nodes</span><span class="p">,</span> <span class="n">branch</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get the next nodes to run based on the current nodes and the graph's edges.</p>
<p>Callable edges are called with the state and shared state.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><span title="src.edgygraph.graph.graphs.Graph[T]">T</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The current state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>shared</code>
            </td>
            <td>
                  <code><span title="src.edgygraph.graph.graphs.Graph[S]">S</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The shared state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_nodes</code>
            </td>
            <td>
                  <code><span title="src.edgygraph.graph.types.Source">Source</span>[<span title="src.edgygraph.graph.graphs.Graph[T]">T</span>, <span title="src.edgygraph.graph.graphs.Graph[S]">S</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The current nodes</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="NextNode (src.edgygraph.graph.types.NextNode)" href="../types/#src.edgygraph.graph.types.NextNode">NextNode</a>[<span title="src.edgygraph.graph.graphs.Graph[T]">T</span>, <span title="src.edgygraph.graph.graphs.Graph[S]">S</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The list of the next nodes including their edges that they were reached by.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/edgygraph/graph/graphs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_next</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span> <span class="n">shared</span><span class="p">:</span> <span class="n">S</span><span class="p">,</span> <span class="n">current_nodes</span><span class="p">:</span> <span class="n">Source</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">],</span> <span class="n">branch</span><span class="p">:</span> <span class="n">Branch</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">NextNode</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the next nodes to run based on the current nodes and the graph&#39;s edges.</span>

<span class="sd">    Callable edges are called with the state and shared state.</span>

<span class="sd">    Args:</span>
<span class="sd">        state: The current state</span>
<span class="sd">        shared: The shared state</span>
<span class="sd">        current_nodes: The current nodes</span>

<span class="sd">    Returns:</span>
<span class="sd">       The list of the next nodes including their edges that they were reached by.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;GET NEXT FOR CURRENT NODES: </span><span class="si">{</span><span class="n">current_nodes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">next_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">NextNode</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">Types</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">]</span><span class="o">.</span><span class="n">is_single_source_sequence</span><span class="p">(</span><span class="n">current_nodes</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;IS SINGLE SOURCE SEQUENCE&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">current_node</span> <span class="ow">in</span> <span class="n">current_nodes</span><span class="p">:</span>
            <span class="n">next_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolve_entries</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">shared</span><span class="p">,</span> <span class="n">branch</span><span class="o">.</span><span class="n">edge_index</span><span class="p">[</span><span class="n">current_node</span><span class="p">])</span>
            <span class="p">)</span>

    <span class="k">elif</span> <span class="n">Types</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">]</span><span class="o">.</span><span class="n">is_single_source</span><span class="p">(</span><span class="n">current_nodes</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;IS SINGLE SOURCE&quot;</span><span class="p">)</span>
        <span class="n">next_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolve_entries</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">shared</span><span class="p">,</span> <span class="n">branch</span><span class="o">.</span><span class="n">edge_index</span><span class="p">[</span><span class="n">current_nodes</span><span class="p">])</span>
        <span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid current_nodes type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">current_nodes</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


    <span class="c1"># Instant nodes</span>
    <span class="n">current_instant_next_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">NextNode</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>

        <span class="n">current_entries</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">entry</span>
            <span class="k">for</span> <span class="nb">next</span> <span class="ow">in</span> <span class="n">current_instant_next_list</span> 
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">branch</span><span class="o">.</span><span class="n">edge_index</span><span class="p">[</span><span class="nb">next</span><span class="o">.</span><span class="n">node</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">instant</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">current_entries</span><span class="p">:</span>
            <span class="k">break</span>

        <span class="n">current_instant_next_list</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolve_entries</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">shared</span><span class="p">,</span> <span class="n">current_entries</span><span class="p">)</span>
        <span class="n">next_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">current_instant_next_list</span><span class="p">)</span>


    <span class="k">return</span> <span class="n">next_list</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.edgygraph.graph.graphs.Graph.get_next_from_error" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_next_from_error</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">shared</span><span class="p">,</span> <span class="n">eg</span><span class="p">,</span> <span class="n">branch</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get the next nodes to execute from the error.</p>
<p>If exceptions in the group dont have the key <code>source_node</code> they will be reraised as an Exception group.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><span title="src.edgygraph.graph.graphs.Graph[T]">T</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The state of the graph.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>shared</code>
            </td>
            <td>
                  <code><span title="src.edgygraph.graph.graphs.Graph[S]">S</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The shared state of the graph.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>eg</code>
            </td>
            <td>
                  <code><span title="ExceptionGroup">ExceptionGroup</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The exception group with all errors to get the next nodes from.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="NextNode (src.edgygraph.graph.types.NextNode)" href="../types/#src.edgygraph.graph.types.NextNode">NextNode</a>[<span title="src.edgygraph.graph.graphs.Graph[T]">T</span>, <span title="src.edgygraph.graph.graphs.Graph[S]">S</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The next nodes to execute.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/edgygraph/graph/graphs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_next_from_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span> <span class="n">shared</span><span class="p">:</span> <span class="n">S</span><span class="p">,</span> <span class="n">eg</span><span class="p">:</span> <span class="n">ExceptionGroup</span><span class="p">,</span> <span class="n">branch</span><span class="p">:</span> <span class="n">Branch</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">NextNode</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the next nodes to execute from the error.</span>

<span class="sd">    If exceptions in the group dont have the key `source_node` they will be reraised as an Exception group.</span>

<span class="sd">    Args:</span>
<span class="sd">        state: The state of the graph.</span>
<span class="sd">        shared: The shared state of the graph.</span>
<span class="sd">        eg: The exception group with all errors to get the next nodes from.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The next nodes to execute.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">next_nodes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">NextNode</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">unhandled</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">eg</span><span class="o">.</span><span class="n">exceptions</span><span class="p">:</span>

        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>


        <span class="n">source_node</span><span class="p">:</span> <span class="n">NextNode</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="s2">&quot;source_node&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source_node</span><span class="p">,</span> <span class="n">NextNode</span><span class="p">):</span>
            <span class="n">unhandled</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="n">entries</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ErrorEntry</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">branch</span><span class="o">.</span><span class="n">error_edge_index</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">match_error</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">source_node</span><span class="p">):</span>
                <span class="n">entries</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">branch</span><span class="o">.</span><span class="n">error_edge_index</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

        <span class="n">entries</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;</span> <span class="n">source_node</span><span class="o">.</span><span class="n">reached_by</span><span class="o">.</span><span class="n">index</span><span class="p">:</span> <span class="c1"># If the error entry is after the node that raised the error</span>
                <span class="n">next_nodes</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolve_entries</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">shared</span><span class="p">,</span> <span class="p">[</span><span class="n">entry</span><span class="p">])</span>
                <span class="p">)</span>

                <span class="nb">print</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">entry</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">propagate</span><span class="p">:</span>
                    <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1"># Not consumed</span>
            <span class="n">unhandled</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>


    <span class="k">if</span> <span class="n">unhandled</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ExceptionGroup</span><span class="p">(</span><span class="s2">&quot;Unhandled node exceptions&quot;</span><span class="p">,</span> <span class="n">unhandled</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">next_nodes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.edgygraph.graph.graphs.Graph.resolve_entry" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">resolve_entry</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">shared</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Resolve the next to nodes.</p>
<p>Make sure to ONLY call this method ONCE per execution of the corresponding edge.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><span title="src.edgygraph.graph.graphs.Graph[T]">T</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The current state.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>shared</code>
            </td>
            <td>
                  <code><span title="src.edgygraph.graph.graphs.Graph[S]">S</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The shared state.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="NextNode (src.edgygraph.graph.types.NextNode)" href="../types/#src.edgygraph.graph.types.NextNode">NextNode</a>[<span title="src.edgygraph.graph.graphs.Graph[T]">T</span>, <span title="src.edgygraph.graph.graphs.Graph[S]">S</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The resolved nodes.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/edgygraph/graph/graphs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">resolve_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span> <span class="n">shared</span><span class="p">:</span> <span class="n">S</span><span class="p">,</span> <span class="n">entry</span><span class="p">:</span> <span class="n">Entries</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">NextNode</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Resolve the next to nodes.</span>

<span class="sd">    Make sure to ONLY call this method ONCE per execution of the corresponding edge.</span>

<span class="sd">    Args:</span>
<span class="sd">        state: The current state.</span>
<span class="sd">        shared: The shared state.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The resolved nodes.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RESOLVING: </span><span class="si">{</span><span class="n">entry</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">next</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">next</span>



    <span class="k">if</span> <span class="ow">not</span> <span class="n">Types</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">]</span><span class="o">.</span><span class="n">is_resolved_next</span><span class="p">(</span><span class="nb">next</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CALLABLE&quot;</span><span class="p">)</span>
        <span class="nb">next</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Callable</span><span class="p">[[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">],</span> <span class="n">ResolvedNext</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">]],</span> <span class="nb">next</span><span class="p">)</span>
        <span class="nb">next</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">shared</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isawaitable</span><span class="p">(</span><span class="nb">next</span><span class="p">):</span>
            <span class="nb">next</span> <span class="o">=</span> <span class="k">await</span> <span class="nb">next</span>


    <span class="k">return</span> <span class="p">[</span>
        <span class="n">NextNode</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">](</span><span class="n">node</span><span class="o">=</span><span class="n">node</span><span class="p">,</span> <span class="n">reached_by</span><span class="o">=</span><span class="n">entry</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_next_nodes</span><span class="p">(</span><span class="nb">next</span><span class="p">)</span>
    <span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>